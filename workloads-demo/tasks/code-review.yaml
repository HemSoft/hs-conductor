# Code Review
# Type: task
# Reviews local git changes and provides AI-powered feedback

id: code-review
name: Code Review Assistant
description: Reviews your git changes and provides AI-powered code quality feedback
type: task
version: 1.0.0
tags:
  - developer
  - code-quality
  - git

alert:
  condition: output.toLowerCase().includes('critical') || output.toLowerCase().includes('security')
  message: "⚠️ Critical issues found in code review!"

steps:
  - id: get-diff
    name: Get Git Diff
    worker: exec-worker
    config:
      command: git diff HEAD
      cwd: .
    output: git-diff.txt

  - id: analyze-quality
    name: Analyze Code Quality
    worker: ai-worker
    config:
      prompt: |
        You are an expert code reviewer. Analyze the following git diff and provide:
        
        1. **Summary**: Brief overview of changes
        2. **Strengths**: What's done well
        3. **Issues**: Problems, bugs, or anti-patterns
        4. **Security**: Any security concerns
        5. **Suggestions**: Specific improvements with line numbers
        6. **Grade**: A-F rating with justification
        
        Be constructive and specific. Use markdown formatting.
      model: claude-sonnet-4.5
    input:
      - git-diff.txt
    output: review.md
